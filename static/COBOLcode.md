 IDENTIFICATION DIVISION.
 PROGRAM-ID. ValidateProviderSegment.

 DATA DIVISION.
 WORKING-STORAGE SECTION.
 01  WS-NPI-NUMBER              PIC X(10).
 01  WS-ADDRESS-LINE            PIC X(50).
 01  WS-CITY-STATE-ZIP          PIC X(50).

 01  WS-ERRORS.
     05  WS-ERROR-COUNT         PIC 9(2) VALUE 0.
     05  WS-ERROR-MESSAGE       PIC X(80) OCCURS 10 TIMES.

 PROCEDURE DIVISION.
     PERFORM INITIALIZE-ERRORS
     PERFORM VALIDATE-NPI
     PERFORM VALIDATE-ADDRESS
     PERFORM DISPLAY-ERRORS
     STOP RUN.

 INITIALIZE-ERRORS.
     MOVE 0 TO WS-ERROR-COUNT.
     MOVE SPACES TO WS-ERROR-MESSAGE.

 VALIDATE-NPI.
     IF WS-NPI-NUMBER NOT NUMERIC OR LENGTH OF WS-NPI-NUMBER NOT = 10
         ADD 1 TO WS-ERROR-COUNT
         MOVE 'Invalid NPI number: ' TO WS-ERROR-MESSAGE(WS-ERROR-COUNT)
         STRING WS-NPI-NUMBER DELIMITED BY SIZE INTO WS-ERROR-MESSAGE(WS-ERROR-COUNT)
     END-IF.

 VALIDATE-ADDRESS.
     IF WS-ADDRESS-LINE = SPACES
         ADD 1 TO WS-ERROR-COUNT
         MOVE 'Address line is missing' TO WS-ERROR-MESSAGE(WS-ERROR-COUNT)
     END-IF.

     IF WS-CITY-STATE-ZIP NOT MATCHING '^[A-Z\s]+,[A-Z]{2}\s\d{5}(-\d{4})?$'
         ADD 1 TO WS-ERROR-COUNT
         MOVE 'Invalid city, state, or ZIP code: ' TO WS-ERROR-MESSAGE(WS-ERROR-COUNT)
         STRING WS-CITY-STATE-ZIP DELIMITED BY SIZE INTO WS-ERROR-MESSAGE(WS-ERROR-COUNT)
     END-IF.

 DISPLAY-ERRORS.
     IF WS-ERROR-COUNT = 0
         DISPLAY 'Provider segment is valid.'
     ELSE
         PERFORM VARYING WS-INDEX FROM 1 BY 1 UNTIL WS-INDEX > WS-ERROR-COUNT
             DISPLAY WS-ERROR-MESSAGE(WS-INDEX)
         END-PERFORM
     END-IF.

 END PROGRAM ValidateProviderSegment.
